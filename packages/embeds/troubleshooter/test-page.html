<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cal.com Embed Test Page - Real Embeds</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 40px;
      background: #f3f4f6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #111827;
      margin-bottom: 20px;
    }
    .section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }
    .button {
      display: inline-block;
      background: #3b82f6;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      text-decoration: none;
      cursor: pointer;
      margin: 5px;
    }
    .button:hover {
      background: #2563eb;
    }
    .error-element {
      background: #fee2e2;
      border: 1px solid #fecaca;
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
    }
    .note {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      padding: 15px;
      border-radius: 6px;
      margin: 20px 0;
      color: #92400e;
    }
  </style>
  
  <!-- Load the REAL Cal.com embed script -->
  <script>
    // Get calOrigin from query params, fallback to localhost:3000
    const urlParams = new URLSearchParams(window.location.search);
    const calOrigin = urlParams.get('calOrigin') || 'http://localhost:3000';
    const embedUrl = calOrigin + '/embed/embed.js';
    
    // Display current origin
    window.addEventListener('DOMContentLoaded', function() {
      const originDisplay = document.getElementById('origin-display');
      if (originDisplay) {
        originDisplay.textContent = calOrigin;
      }
    });
    
    (function (C, A, L) {
      let p = function (a, ar) {
        a.q.push(ar);
      };
      let d = C.document;
      C.Cal =
        C.Cal ||
        function () {
          let cal = C.Cal;
          let ar = arguments;
          if (!cal.loaded) {
            cal.ns = {};
            cal.q = cal.q || [];
            d.head.appendChild(d.createElement("script")).src = A;
            cal.loaded = true;
          }
          if (ar[0] === L) {
            const api = function () {
              p(api, arguments);
            };
            const namespace = ar[1];
            api.q = api.q || [];
            if (typeof namespace === "string") {
              cal.ns[namespace] = cal.ns[namespace] || api;
              p(cal.ns[namespace], ar);
              p(cal, ["initNamespace", namespace]);
            } else p(cal, ar);
            return;
          }
          p(cal, ar);
        };
    })(window, embedUrl, "init");
    Cal("init", {origin: calOrigin});
  </script>
</head>
<body>
  <div class="container">
    <h1>Cal.com Embed Test Page - Real Embeds</h1>
    
    <div class="note">
      <strong>Note:</strong> This page loads the REAL Cal.com embed script. 
      When you click the booking buttons, they will try to open actual Cal.com booking pages.
      The links may not work if the usernames/event-types don't exist.
      <br><br>
      <strong>Current Origin:</strong> <span id="origin-display" style="font-family: monospace; background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">Loading...</span>
    </div>

    <div class="section">
      <h2>Test Controls</h2>
      <button class="button" onclick="injectTroubleshooter()">Inject Troubleshooter</button>
      <button class="button" onclick="createInlineEmbed()">Create Inline Embed</button>
    </div>

    <div class="section">
      <h2>Modal Triggers (Click to test)</h2>
      <div data-cal-link="rick/get-rick-rolled" class="button">
        Get Rick Rolled
      </div> 
      <div data-cal-link="nonexistent/meeting" class="button" style="background: #dc2626;">
        Test 404 Error (Non-existent link)
      </div>
    </div>

    <div class="section">
      <h2>Inline Embed</h2>
      <div id="inline-container" style="min-height: 400px;">
        <!-- Inline embed will be added here -->
      </div>
    </div>

    <div class="section">
      <h2>Namespaced Embeds</h2>
      <button class="button" onclick="Cal.ns.booking('modal', {calLink: 'peer/15min'})">
        Open via Booking Namespace
      </button>
      <button class="button" onclick="createCustomNamespace()">
        Create Custom Namespace
      </button>
    </div>
  </div>

  <script>
    function injectTroubleshooter() {
      const script = document.createElement('script');
      // Add cache busting query parameter
      // Abcd because of a weird behaviour where just number seems to serve outdated file
      script.src = `/dist/troubleshooter.js?t=${Date.now()}abcd`;
      document.head.appendChild(script);
    }

    function createInlineEmbed() {
      const container = document.getElementById('inline-container');
      container.innerHTML = ''; // Clear existing content
      
      Cal("inline", {
        elementOrSelector: container,
        calLink: "rick/get-rick-rolled",
        config: {
          theme: "light"
        }
      });
    }

    // Initialize a booking namespace
    Cal("init", "booking", {
      origin: calOrigin
    });
  </script>
</body>
</html>